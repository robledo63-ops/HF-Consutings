
import React, { useState, useCallback } from 'react';
import { editImage } from './services/geminiService';
import type { ImageEditResult } from './types';
import { ImageUpload } from './components/ImageUpload';
import { PromptInput } from './components/PromptInput';
import { ResultDisplay } from './components/ResultDisplay';
import { Loader } from './components/Loader';

const logoBase64 = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAACACAYAAAC6yG2dAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAE/dSURBVHgB7Z0HgB1F1cf/d2d2d3d3d2cnmSRCEpIQEggegsceeyw2GIMxxhgjJhiT2MQmxhgTxWBiDBoLPMaggWBPDgkkd5BCCCEk3Z3d75yZmpme6ZmZWZJJAs/v9y/P9FR1dXV11dVV1ffV9QzTNE1EREREREQkKjW6AEREREREREQkPggChURERERERCSqDAFCERERERERkagyBAhFREREREREpsoQIBQRERERERGRqDIECEVEREREREQkqvzX6AJs27YtJk+eTCxTpkzMnDkzxowZg4SEBEycOFEqlUqlUoWEhGD27Nnhc5w4cYJWrVoRi8nIyAiDBw+WlpYWMjIyMHnTTx8+igQpUqqVatg/fr1AjfffBM9evQgd+7cwYwZM6CyshLLli2D1q1b46mnnsKECRMwa9YsuHbtGuzYsQPx8fEAgwcPhgkTJmDz5s0YMmQIMjIyMHnyZMyYMQMLFy6EdevWYf369fjss88QGxuL559/Xv7+uHHjEBgYCHPmzMHWrVsxbNgwDBs2DBs3bsSBAwfK3z937hy2bNmCcePG4eCDD8bIkSPxww8/4NVXX8XatWsxbdo0vPjii2jXrh3atm0r9+fMmYN58+ahWbNmuPfee/HUU0+hffv2OH78uNzfsmVL7N27F/Hx8Zg2bZr8/YULF6JFixZYvHgxdu/ejQkTJsj9lpaW8MUXX2Dbtm1o0qQJli9fjjlz5mDVqlV47rnnkJSUhG+++QaLFy/Gjh07kJWVhaVLl8Kb3/zm/P379u1Dw4YNsW3bNsyfPx8vvPACJk+ejDfffBPffvstGjRoID/c1q1bY8OGDXjjjTfw4osvIiUlBS1atMCLL76I1q1bY+vWrfjlL38p//4nP/lJDBs2DE8//TQ++ugjfPvb38aCBQvgd955B02bNkWTJk3knr355pt4/vnnMWPGDHz++ee48cYb5f5169ahbt26ePHFF3HPPfcgLCwMjzzyiPz9FStW4O6778a4cePwxRdfYO/evZg7dy7Wr1+Pxx9/HCdPnsATTzyBBQsW4Omnn8aZZ56JIUOGYP/+/ZgxYwYWL16MF198Ea1bt5bv85xzziE4OBjbtm3DggULkJKSgnnz5mH69Ony97169ZK/X7VqFRYsWCAv3vnnn4/nn38eW7ZsQWhoKAYOHIhf//rXGDt2LNavX4958+ZBr169EBkZKY+rX78+zp07h4kTJ8r9unXrhvXr1+O+++7DqFGj8PHHH+Ott97CsmXLMHPmTLzxxhu46667EBcXh127diE8PFyey5IlS/DAAw/g9ddfx6hRo7B69Wo8+uij+NOf/oQnn3wSn3zyifz9X//617j22mvhz3/+s/z9ixYtwgMPPICbb74ZkyZNkvuTJk2S19Fbb72FhQsX4umnn5Zf7v3338eCBQvw7rvv4tlnn8XmzZtx880344knnsDSpUvhggsuQHJyMlauXIknnnjC/O9bS0REpM3zRgg97e/atQuHDh3C/fffjwEDBuCdd97BkiVLkJmZib/+9a/47LPPsHTpUnzwwQeIiYnBrFmzEBkZiWnTpmHw4MFITEzEmDFjMHPmTAwdOhR9+/bFnXfeyZ176tQpfPTRRxgyZAgyMjKwe/duXLx4EbGxsfj222/lvk8++SQGDBiAnTt3Yvjw4fjrX/8q//6f//znGDJkCDZt2oSFCxfCyJEj8emnn2LixIlITEyUe65Vq1ZITk6GDRs2ICkpCW3atMHevXvlnv/iF7/A119/jQEDBmDatGkYMmSI/L1jx45YuXKl/H3fvn2xYcMGZGRk4NVXX8X777+Pe+65BxMmTMC6devQpk0bnD59GtOnT8frr7+O7du34/PPP8fTTz+NxMRE+fv+/fvjxRdfxDvvvIMZM2bg4MGDefe56aab8MUXX+TKK1avXo1PP/0Uixcvxptvvokvv/wSW7duxV133YWnn35aXs8vv/yCN998E5deeilWrFiBsWPH4umnn8bgwYOxbds2/OEPf8SlS5fknlevXo0f/ehHuOiii/C9730PgwYNkvdfvHgx/vWvf+HBBx/Eiy++iGXLluG1117DiSeeKHe/d+9evP7665gyZQr+/e9/Y+LEifjuu+/QtGlT/PznP5f3ffv27XjggQdw77334oUXXsD69evx/PPP46mnnpL7OnXqhGnTpmH+/Pk4f/68/P0//vGP+NnPfoYnnniCmpoaXHjhhbj++uvRqlUr9O3bV36vdevWyWv37NkDd9xxB2655RasX78ew4YNAwDo0KGD3LdTp0545pln8M4772DevHl48skn8aUvfel8Z2zYsAEXXHABnnnmGVx33XX4wQ9+gE8++QSLFi3CqVOn8N5772HVqlXYv38/li1bhtdeew2ff/45nn76aRw+fBjLly/H3XffLU/Pnz8fixYtQt++ffHGG2/giSeeQEREBJYsWYKnnnoK8+fPx4QJE7BixQoEBwejq1ev5P6DBw/Gr3/9axy/fhyvvvoqrryycuXKeOaZZ/DRRx/hL3/5S5njm0tERKRN80YIPe0jR46Ue16wYAFeffVV/PCHP5T7XbJkCVatWoWioiJMnjwZ559/PhISErB48WJMnDgRw4cPxxtvvIH58+fL3b98+XL86le/ktfRxIkTMWDAANx6661ITU3FnXfeyZ4mXbt2xZtvvolJkybhrrvuwp///GfYunUrjh8/jrNnz+LChQvyf+7Ro4ccZ+LEifjggw/QtGlTnHPOOdi+fbt8b/78+Xj99ddx/PhxjBgxAv/+978RGxuLjz76CJMnT8bnn3+Op556Su6vVq2a/P2VKlVi7ty5OPvss+XevWPHDmzZsgX/+c9/EBISgnPPPRevvPIKxo0bh/bt2+OTTz7B5MmTsXv3bjz55JNISEhAZmYm5s2bh7Nnz2LDhg1YtWoVnnnmGaxbtw6jR4/GCy+8gJsvvxyvv/8+li1bhpUrV8p9lixZgmuuuQYPPfQQJkyYgB//+MfIzMyUXy9nzpzB119/je3bt6NevXpyv759+yIlJQWvvPIKrrjiCnTu3BkzZsxAcnKyvCckJAQjR47EDTfcgHvvvRe33XYbHnzwwfL3devWYe7cuZg0aRKGDx+O1atXIzY2FhMnTsRFF12EdevW4T//+Q8mTJgArVq1wtatW3HixAnMnTsXzz77rNyrVauW3LNly5b44YcfsG3bNrRo0QIvvPCCPM+qVavQoUMHjB49Gi+88AI2bdokd5s3bx5mzZqFxx9/HPv27cP8+fPxzDPP4MSJE3jqqafknufNm4drr70WmzdvRt++ffHJJ5+gVatWGDVqFFatWoVXX30VJ554Inr06IGvvvqK/O8nn3wCV65cwYwZM7BixQoEBweja9eu+Pbbb2X+d+zYgUGDBmHp0qX47W9/i1atWuHyyy/HoEGDMGfOHPzzz39i5syZ8Lvf/S727duHE088ER9//DHefvttyS7cM2bMwOuvv47nn38ed9xxByZPnoybb74ZkyZNkvft3LkznnjiCbz22mv4+c9/jsmTJ+N3v/sdFi5cKPetW7dO7rZv3z588cUX+Na3voV58+bJc5o1a4YHHngA5557Lnbs2IFZs2bJ3Xbu3Bl//vOf8dRTT2HixIn4/e9/j+3bt8vtNm7ciCuvvBL/+c9/cPHFF8v9/uAHP8B3332HsmXLYu/evdi+fTsGDBiAnTt3YuHChcjOzpbnpKSkICUlBYsWLcq9Z82ahbFjx+Kxxx7D7t27ERcXh23btuGdd97BsGHDsGDBAvz2t79Fhw4dEBcXh7vuuguZmZny/e7evRuXXXYZDh48iN/+9rf4xS9+AYmJifL8/v37Y9OmTXjxxRdx++23IzExEe+99x5++tOf4pVXXsG5556LoUOHIiUlBTExMXjooYdkd0lERKSt8kYIPe3Nnj0bf//73/Hyyy9j7ty5+OCDD/Diiy/ixRdfxP/93/9h8ODB+Na3voVhw4Zhzpw5ePPNN9GnTx906dIFixcvxtixY/Hoo49izpw5+MUvfoFXX30VP/jBD5CWloZRo0bJG8Btt92GN954AwcPHsQFF1yAoUOH4utf/zp+/etfY+jQoTh+/Ljc+/bt28sza9asaNKkCXr16oUHHniAHTt2YPny5XjqqafwrW99CyEhIfjrX/9aXif/+te/Yvny5aioqMCiRYvgjTfekBvC2LFjMWbMGHz88cey+wYNGsQBBxyAPXv24MMPP8SKFSvkefv27Yu33noLUlJS8KWvfAn/+7//i+3bt+PnP/+5PGd6ejqeeuop7Nq1C6+99hr++te/4rbbbsM333wjd9u0aZN8v3nz5uFf//oXXnrpJfz85z/HvHnz8POf/1w+t3jxYtx999341a9+hWeeeQZvvvkm/vSnP+HWW2/F+vXr8eCDD8p9lpaW4s9//jNefvll/PjHP8ann36KVatWyXs6dOiAP/zhD7jjjjvw1re+hVWrVmHgwIFYt26d/L5du3bhxRdfxHvvvYcZM2bg4MGDefe56aab8MUXX8g7P3/+fPxwhz/EI488givXruGKK67AtGnTcP78efn73/3udwgLC8PnP//5874tW7bi9ddfx5NPPokZM2bgoosuQlhYGN58801ce+21uOOOO3DjjTdi/fr1OHz4MMaNGyf/+/7778cPf/hDfPOb38S7774ri2v269cPb7zxBi688EIsXrwY48ePxx//+EcMHz4cgYGB+PznP49p06bJ+/7f//1fsGzZMjz++OO46aab0K1bN3h6euLmm29GVlYWnnjiCaSnp2PatGnIzMxEQkICnn/+eVitVjzwwAPw9PTExIkT0a9fPwwbNkwel1/OnDmDrKwsXHnllcjJyfF/joiISA/njRB62hde/OMfH/QoP/rRj1BcXByPPfaYfH9BQQGGDRsmfy8oKAjDhg2T+y5ZsgSzZ8+W2zRu3Bivv/66PK9NmzYICAhAmzZt5PuWL1+OAwcO4JZbbsFDDz0kf8+LL76Izz77DDZt2oS///3v+OKLLzBp0iR536NHj8o9W7duzbzvqVOnyvsSEhKwatUqXH311cjPz8fXX36JlStXYv78+XjooYdwyy234LrrrsNrr72GXbt2yXvOnz8fr732GtasWYMbb7wRzz33HF555RXZzWbOnImnn34af/7zn/G9730Po0ePlnefN28elpaW8J//+Z/44447ZNfev39/bNy4EYcOHcKUKVMEePHFF7F06VJZzH/yySfx0EMPyV738ssvY+vWrThw4ACeffZZ+fqnn36KxMRE/OQnP8H9998vd+vfv7/8XKlSJbz55puoqKiA2tpatG3bFn/5y19kZ1+9ejVWrFiBBQsWoGHDhviXf/kX+fnVq1dj0aJFGDJkCHw+H8aOHYtLL70U69evx/vvv4+XX34ZU6dORVpaGkJDQ/HOO+8gKyuLfH3u3Lk4d+4cRo8ejdq1a8vf79u3LzZu3IiXXnoJBQUF+PnPf445c+agcuXKGD58OBYvXgznz8l85/b/vLy88Prrr8PHxwfbtm2TzTt16hTTp0+X95ctW4Zly5ZJ418zIiIimX6eN0L4f2vWrMG4cePQv39/fPbZZ3j88cfx8MMPY/v27YiNjcXSpUvx4Ycfola1ahg7dix27NiBbdu2ITY2Vh7v8ePHGDt2LD755BN07NhRfr9y5cqora0td8vPz4eLiwu+/fZb+fjAwEDZf9evXx9fffVVuf3gwYO4d+8exs+PzG7b+vXrZ34Gq1WLZs2a4cknn5S/X7x4Mfbv3y+v27p1azRr1kyef//993Hw4EHYbDYMHTpUPm5mZgbr1q3D9OnTMWDAANjY2MDd3R3Tp0/HxIkTZfZ7eHh4YPTo0diwYQOWLVsGe3t7nDhxAnfffTeOHj2Kvn37wt/fX1538ODBuOOOO+Tj9u/fj+3bt8Pf318e47fffsu8L1u2LDw8PMjPDw4OxvTp0+VjvvHGG/jwww9hNBrl57Kzs2E0GvL2CRMm4LXXXkNDQwNGjhwpr/fw8MCqVaswZ84cuW3u7u7YtWuXPJ4VK1Zg3bp1mDlzptxv3bp1uHXrFn71q19hzJgxOHToEAYOHCh/LywsDOfOncNzzz2HV199Ff/7f/+P2tpaXHXVVVi4cKFsXzZs2CDL2q9YsQKDBg2S+7777ju8//77uHDhggz7P3nyJMb4+XlZ1v7rr7+Wv8/MzJSPm5+fn//P8f81IiKS8eQDIYT/jIiIiIiIiEj+EwhCiIiIiIiIyFQlK4SIiIiIiIjIFCFAGERERERERCRqDAFCERERERERkagyBAhFREREREREpsoQIBQRERERERGRqDIECEVEREREREQkKq3Q6BZEREREREQkqq7UakVERERERCRqAgFCIiIiIiIiUnX/2wGiIiIiIiIif4oAIURra2uMHj1aXhfQ2NiIn//857L3R0RERET+EAhCqFarhYeHh/r6evTt21fee/To0Xj99dfl7/fq1YuMjAxMnz69yu0TERER+ceE+xBEREREREREpMoypBeSiIiIiIiIiFQBAoQiIiIiIiIiUQUCEERERERERCSqDAFCERERERERkagyBAhFREREREREpsoQIBQRERERERGRqDIECEVEREREREQkKq3Q6BZEREREREQkqqxerxZTU1Ns375dLr9ly5ZpXbeIiIiIiIhUfHl5eYiMjJS9fwiIiIiIiIgI/x8ChCIiIiIiIiLdkZeXh+3bt2Pt2rWy9w8FIkSo0WgkJycHe/fule1/2rRpOHXqFDp16hQ3r0VERCSz+Pj4IC8vDzdv3pTbfvfdd/D7/fLzFQQhNn/+/Lzz/qFDh7B161asW7cOiYmJuPPOO+XsA0RERCS/0xhiERGR9Pnz51ixYgXWrVsHV1dXXH755XB1dWX3P3PmTPTo0UO+5fP54OjoKJv/RERERCS9CAGEaPny5QgICMDSJUugtLQ0c79PnjyJBQsWICAgAPv27ZMx3RIRERHJcMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhCBERERERERHJYMIhC-BHQAEAAAABJRU5ErkJggg==";

const App: React.FC = () => {
  const [prompt, setPrompt] = useState<string>('');
  const [imageFile, setImageFile] = useState<File | null>(null);
  const [inputImageUrl, setInputImageUrl] = useState<string | null>(null);
  const [result, setResult] = useState<ImageEditResult | null>(null);
  const [isLoading, setIsLoading] = useState<boolean>(false);
  const [error, setError] = useState<string | null>(null);

  const handleImageChange = (file: File | null) => {
    if (file) {
      setImageFile(file);
      const reader = new FileReader();
      reader.onloadend = () => {
        setInputImageUrl(reader.result as string);
      };
      reader.readAsDataURL(file);
      setResult(null); // Clear previous results
      setError(null);
    } else {
      setImageFile(null);
      setInputImageUrl(null);
    }
  };

  const handleSubmit = useCallback(async (event: React.FormEvent) => {
    event.preventDefault();
    if (!prompt || !imageFile || !inputImageUrl) {
      setError('Please provide an image and a descriptive prompt.');
      return;
    }

    setError(null);
    setIsLoading(true);
    setResult(null);

    try {
      const base64Data = inputImageUrl.split(',')[1];
      const mimeType = imageFile.type;

      const response = await editImage(prompt, base64Data, mimeType);
      setResult(response);
    } catch (err) {
      console.error(err);
      setError(err instanceof Error ? err.message : 'An unknown error occurred.');
    } finally {
      setIsLoading(false);
    }
  }, [prompt, imageFile, inputImageUrl]);

  return (
    <div className="min-h-screen bg-gray-900 text-gray-100 font-sans flex flex-col items-center p-4 sm:p-6 md:p-8">
      <header className="w-full max-w-5xl text-center mb-8">
        <img src={logoBase64} alt="HFconsultings Logo" className="w-48 mx-auto mb-4" />
        <h1 className="text-4xl sm:text-5xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-teal-400 to-yellow-500">
          HFconsultings
        </h1>
        <p className="mt-2 text-lg text-gray-400">
          Generador de imagen para empresas
        </p>
      </header>
      
      <main className="w-full max-w-5xl">
        <form onSubmit={handleSubmit} className="bg-gray-800/50 rounded-2xl p-6 sm:p-8 shadow-2xl border border-gray-700 backdrop-blur-sm">
          <div className="grid grid-cols-1 lg:grid-cols-2 gap-8">
            <div className="flex flex-col space-y-6">
              <ImageUpload onImageChange={handleImageChange} inputImageUrl={inputImageUrl} />
              <PromptInput prompt={prompt} setPrompt={setPrompt} />
            </div>
            <div className="flex flex-col items-center justify-center bg-gray-900/50 rounded-xl p-4 border border-dashed border-gray-600 min-h-[300px] lg:min-h-full">
              {isLoading ? (
                <Loader />
              ) : (
                <ResultDisplay result={result} error={error} />
              )}
            </div>
          </div>

          <div className="mt-8 text-center">
            <button
              type="submit"
              disabled={isLoading || !prompt || !imageFile}
              className="inline-flex items-center justify-center px-8 py-3 font-semibold text-white transition-all duration-300 bg-gradient-to-r from-purple-600 to-pink-600 rounded-lg shadow-lg hover:from-purple-700 hover:to-pink-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-900 focus:ring-purple-500 disabled:opacity-50 disabled:cursor-not-allowed disabled:saturate-50"
            >
              <svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z" />
              </svg>
              {isLoading ? 'Generating...' : 'Apply Magic'}
            </button>
          </div>
        </form>
      </main>

      <footer className="w-full max-w-5xl text-center mt-12 text-gray-500 text-sm">
          <p>Powered by Google Gemini. Images are not stored.</p>
      </footer>
    </div>
  );
};

export default App;